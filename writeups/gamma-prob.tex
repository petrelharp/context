\documentclass{article}
\usepackage{amsmath,amssymb,amsthm}
\newcommand{\E}{\mathbb{E}}
\renewcommand{\P}{\mathbb{P}}
\newcommand{\given}{\;\vert\;}
\newcommand{\Beta}{B}

\begin{document}

Suppose that $(X_t)_{t\ge0}$ is a continuous-time Markov process with generator matrix $G$,
i.e.\ $G_{ij}>0$ if $i\neq j$ and rows of $G$ sum to zero.
Let $\tau$ be an independent Gamma distributed time with shape parameter $\alpha$ and scale parameter $\beta$.
We would like to compute the probabilities
\[
  Q(x,y;\alpha,\beta) := \P\{ X_\tau = y \given X_0 = x \} 
\]
in an efficient manner,
focusing on the case when $G$ is large and sparse.

Consider the corresponding ``jump chain'',
which represents $X$ as $X_t = M_{N(\lambda t)}$,
where $N(t)$ is a unit Poisson process and $M$ is a discrete-time Markov chain.
Here $\lambda$ is the maximum transition rate $\lambda = \max_i \{ - G_{ii} \}$,
and the transition matrix for $M$ is given by
\begin{align}
    P_{xy} &:= \P\{M_{k+1} = y \given M_k = x\} \\
        &= \begin{cases}  
                G_{xy}/\lambda \qquad & x\neq y \\
                1+G_{xx}/\lambda \qquad & x=y 
            \end{cases} .
\end{align}

$N(\lambda \tau)$ has a negative binomial distribution, with parameters $\alpha$ and $\lambda/(\lambda+\beta)$:
\begin{align}
  \P\{ N(\lambda \tau) = n \} &= \int_0^\infty \frac{ \beta^\alpha }{\Gamma(\alpha)} t^{\alpha-1} e^{-\beta t} e^{-\lambda t} \frac{ (\lambda t)^n }{ n! } dt \\
  &= \frac{ \beta^\alpha }{ \Gamma(\alpha) n! } \frac{\lambda^n}{(\lambda+\beta)^{n+\alpha}} \int_0^\infty t^{n+\alpha-1} e^{-t} dt \\
  &= \frac{ \Gamma(n+\alpha) }{ \Gamma(\alpha) \Gamma(n+1) } \frac{ \beta^\alpha \lambda^n }{(\lambda+\beta)^{n+\alpha}}\qquad \text{for } n \ge 0 .
\end{align}
It follows that
\begin{align}
    Q(x,y;\alpha,\beta) = \sum_{n \ge 0} \P\{ N(\lambda \tau) = n \} P^n  .
\end{align}
Note that 
\begin{align}
  \frac{ \P\{ N(\lambda \tau) = n+1 \} }{ \P\{ N(\lambda \tau) = n \} } &= \frac{ \Gamma(n+\alpha+1) \Gamma(n+1) }{ \Gamma(n+\alpha) \Gamma(n+2) } \frac{\lambda}{\lambda+\beta} \\
  &= \frac{ n+\alpha }{ n+1 } \frac{\lambda}{\lambda+\beta} ,
\end{align}
which is helpful for computing this.
The error in approximating this by a finite sum up to $n_0$ is bounded by $\P\{N(\lambda \tau)>n_0\}$.



\end{document}
